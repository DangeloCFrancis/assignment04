---
title: "index"
author: "D'Angelo Francis and Su Yeon Seo, Georgetown University \n McCourt School of Public Policy"
format: html
embed-resources: true
---

```{r setup, message=FALSE, warning=FALSE}

# make sure to load all packages here up top. If you need to install a package, include the commented code here as well :)

library(fontawesome) # install.packages("fontawesome") - for waffle graphs
library(styler) # install.packages("styler") - check for Tidy style guide adherence
library(lintr) # install.packages("lintr") - check for Tidy style guide adherence
library(tidyverse)
library(readxl)
library(haven)
library(tidyverse)
library(patchwork) # easy combine plots
library(tigris) # direct download of shape files from US Cenus 
library(sf) # manipulate shapefiles 
library(tidycensus) # shapefiles from Census 
library(rgeoboundaries) # international boundaries 
library(ggrepel)  # install.packages("ggrepel")
library(janitor)  # install.packages("janitor")
library(ggthemes) # install.packages("ggthemes")


options(scipen=999) # no scientific notation for plots


```

## The story beind the visualizations

<<<<<<< dangelo
I believe that we will need these links 

- [Figures](https://quarto.org/docs/authoring/figures.html)
- [Cross Reference](https://quarto.org/docs/authoring/cross-references.html)
- [Tidyverse Style Guide Packages](https://style.tidyverse.org/)
- [Urban Style Visualization Style Guide](https://urbaninstitute.github.io/r-at-urban/graphics-guide.html)

Research Question: What is the relationship between household income and fertility among Koreans by province?
=======
In deciding this 
Question: What is the relationship between GRDP, household income, and women's rights on fertility among South Koreans by province? 
>>>>>>> local

## Graph 1A - South Korean Fertility Rate by Province

Put purpose and data story here, along with [data source]()

```{r graph 1, message=FALSE, warning=false}

# getting geospatial data prepped

rok <- geoboundaries(
  country = "Republic of Korea",
  adm_lvl = "adm1")

rok_cities <- 
  read_sf("data/cities.geojson") |>
  clean_names() |>
  filter(ctry == "South Korea")
  
rok_major_cities <-
  rok_cities |>
  filter(name %in% c("Seoul","Busan","Incheon","Ulsan","Daegu","Daejeon","Gwangju"))

# bringing in fertility data source , cleaning data up

rok_fertility_province <- 
  read_csv("data/Agespecific_Fertility_Rate_Province__20241008012056.csv") |>
  clean_names() |>
  pivot_longer(
    cols = starts_with("x", ignore.case = TRUE),
    names_to = "year",
    values_to = "fertility_rate"
    ) |>
  rename(shapeName = by_province_1 , age = by_age_1) |>
  select(-by_variant_1) |>
  filter(shapeName != "Whole country", age == "TFR", year == "x2022") |>
  mutate(shapeName = case_when(
    shapeName == "Chungcheongbuk-do" ~ "North Chungcheong",
    shapeName == "Chungcheongnam-do" ~ "South Chungcheong",
    shapeName == "Jeollabuk-do" ~ "North Jeolla",
    shapeName == "Jeollanam-do" ~ "South Jeolla",
    shapeName == "Gyeongsangbuk-do" ~ "North Gyeongsang",
    shapeName == "Gyeongsangnam-do" ~ "South Gyeongsang",
    shapeName == "Jeju-do" ~ "Jeju",
    shapeName == "Gangwon-do" ~ "Gangwon",
    shapeName == "Gyeonggi-do" ~ "Gyeonggi",
    .default = shapeName
    )
  ) 

rok_fertility_shapefile <- 
  full_join(rok, rok_fertility_province, by = join_by(shapeName)) |>
  st_as_sf()

```

```{r}
#| warning: false
#| fig-cap: "South Korea's Fertility Rate by Province"
#| fig-format: pdf

# plot code

korea_fertility_plot <-
  ggplot() + 
  geom_sf(data = rok_fertility_shapefile, aes(fill = fertility_rate)) +
  geom_sf(data = rok_major_cities) + # gives us city points 
  geom_label_repel(data = rok_major_cities, mapping = aes( x = lon, y = lat, label = name)) +
  scale_fill_continuous(
    name = "Total Fertility Rate \n Number of Children",
    low = "#fff",
    high = "#0F64CD"
  ) + 
  theme(
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    text = element_text(face = "bold")
  ) + 
  labs(title = "South Korea's Fertility Rate",
       subtitle = "South Korea is below replacement rate(2.1 children) nationwide, \n especially in metropolitan areas",
       caption = "Source: Statistics Korea")

korea_fertility_plot

ggsave(filename = "korea.pdf")

```


## Alternate Graph 1B - South Korean GDP by Province (GRDP)

Put purpose and data story here, along with [data source](kosis.kr)

```{r}
#| message: false
#| fig-cap: "South Korea's 2022 Nominal Gross Regional Domestic Product (GDRP)"
#| fig-format: pdf

# prep gdrp data 

rok_grdp <-
  read_excel("data/Korean GRDP Wikipedia Excel import.xlsx") |>
  clean_names() |>
  mutate(region = case_when(
    region == "Gangwon Province, South Korea" ~ "Gangwon",
    region == "Gyeonggi Province" ~ "Gyeonggi",
    region == "Jeju Province" ~ "Jeju",
    region == "North Chungcheong Province" ~ "North Chungcheong",
    region == "North Gyeongsang Province" ~ "North Gyeongsang",
    region == "North Jeolla Province" ~ "North Jeolla",
    region == "South Chungcheong Province" ~ "South Chungcheong",
    region == "South Gyeongsang Province" ~ "South Gyeongsang",
    region == "South Jeolla Province" ~ "South Jeolla",
    .default = region
  )
  ) |> 
  rename(shapeName = region)

rok_grdp$gdp_won <- 
 as.numeric(gsub("KRâ‚©|trillion", "", rok_grdp$gdp_won))


rok_grdp$gdp_us <-
  as.numeric(gsub("US\\$|billion","",rok_grdp$gdp_us))

rok_grdp_shapefile <- 
  full_join(rok, rok_grdp, by = join_by(shapeName)) |>
  st_as_sf()

korea_grdp_plot <-
  ggplot() + 
  geom_sf(data = rok_grdp_shapefile, aes(fill = gdp_us)) +
  geom_sf(data = rok_major_cities) + # gives us city points 
  geom_label_repel(data = rok_major_cities, mapping = aes( x = lon, y = lat, label = name)) +
  scale_fill_gradient(
    name = "Gross Regional Domestic Product, \n 2022 $US Billion",
    low = "#fff",
    high = "#CD2E3A"
  ) + 
  theme(
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank(),
    text = element_text(face = "bold"),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
  ) + 
  labs(
    title = "South Korea Gross Domestic Product (GDP) by Province",
    subtitle = "A majority of South Korea's GDP comes from its capital and surrounding region",
    caption = "Source: Korean Statistical Information Service"
  )
  theme_void() +
  theme(text = element_text(face = "bold"))

korea_grdp_plot
```

## Alternate Graph 1C - stitched graphs 

```{r stich plots together}
#| echo: false
#| message: false
#| fig-format: pdf

korea_fertility_plot / korea_grdp_plot

ggsave(filename = "combined_gdp_fertility_plot.pdf")

```

**MAKE SURE TO COMMIT AFTER FINSIHING**

\pagebreak

## Graph 2 - 

Add purpose and Data Source: []() - remember to add to repo

- Probably want to do plot with aging or women's rights here....

```{r graph 2}

# brining in global gdp data , cleaning up

world_gdp_2023 <- 
  read_excel("gdp_2023.xls") |>
  clean_names() |># from janitor() package 
  pivot_longer(
    cols = starts_with("x", ignore.case = TRUE),
    names_to = "year",
    values_to = "gdp",
    values_drop_na = TRUE
  ) |>
  select(-indicator_code) # not needed 

world_gdp_2023$year <- as.numeric(gsub("x","",world_gdp_2023$year)) # prep for time series viz 

rok_gdp_1970_2023 <- 
  world_gdp_2023 |>
  filter(country_code == "KOR") |>
  mutate(gdp = gdp/10e6)

rok_gdp_fertility <-
  full_join(x = rok_fertility_1970_2023, y = rok_gdp_1970_2023, by = join_by(year))

# create south korea's fertility-gdp comparison map

ggplot(data = rok_gdp_fertility, aes(x = gdp, y = total_fertility_rate_persons, label = year)) +
  geom_point() +
  geom_text_repel(size = 3) + 
  geom_smooth(se = FALSE) +
  labs(
    title = "The Relationship between \nGross Domestic Product (GDP) & Fertility Rate in South Korea: 1970 - 2023",
    subtitle = str_wrap("Overtime, South Korea's GDP has increased while the Fertility Rate has decreased"),
    caption = "Source: The World Bank, Korean Statistical Information Service (KOSIS)",
    x = "GDP (US$ - 2023)",
    y = "Total Fertility Rate (Persons)") + 
  theme_minimal() + 
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(),
    text = element_text(face = "bold"))
  

```

**MAKE SURE TO COMMIT AFTER FINSIHING**

\pagebreak

## Graph 3 -

Data Source: []() - remember to add to repo

```{r}


```

**MAKE SURE TO COMMIT AFTER FINSIHING**

## Graph 4 - 

Data Source: []() - remember to add to repo 

```{r bring in and clean data}

rok_2024_obligation_sentiment <- 
  read_excel("data/rok_2024_obligation_sentiment.xlsx") |>
  pivot_longer(
    cols = 1:5,
    names_to = "question",
    values_to = "percent_agree"
  ) |> 
  filter(question != "total")

ggplot(data = rok_2024_obligation_sentiment) + 
  geom_col(aes(x = factor(question, 
                          levels = c("decide_for_themselves","women_have_obligation","it_depends","refused"),
                          labels = c(str_wrap("Should Women decide for themselves?"),
                                     str_wrap("Do Women have an obligation?"),
                                     str_wrap("Does it depends on the situation?"), 
                                     str_wrap("Don't Know or Refused to Answer"))),
               y = percent_agree), 
           fill = "#0F64CD") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(size = 6.5),
    text = element_text(face = "bold")
    )+ 
      labs(
        title = "South Koreans are alright with declining birthrates...?",
        subtitle = "Despite declining birthrates, South Koreans are not pressuring women into having more children",
        caption = "Source: Pew Research Center Survey 2023: Religion in East Asia Survey Topline Questionanaire",
        x = "Question",
        y = "Percent (%) who agree (N = 2,104)"
      ) 
  

```

```{r save for future use}
#| warning: false
#| message: false

rok_gii <- read_excel("data/rok_hdr_data.xlsx") |>
  pivot_wider(
    names_from = indicator,
    values_from = value
  ) |>
  remove_empty() |>
  clean_names()

rok_gii$year <- as.numeric(rok_gii$year)

rok_gii_fertility <- 
  filter(.data = rok_fertility_1970_2023, year %in% (1990:2022)) |>
  full_join(rok_gii, rok_fertility_1970_2023, by = join_by(year))

ggplot(data = rok_gii_fertility, aes(x = gender_inequality_index_value, y = total_fertility_rate_persons, label = year)) +
  geom_text_repel(max.overlaps = 20) +
  geom_point() + 
  geom_smooth(se = FALSE, color = "#0F64CD") +
  geom_vline(xintercept = .462) +
  annotate("text", x = .455, y = 1.25, label = "World (2022)", angle = 90)+
  scale_x_continuous(n.breaks = 15)+
  labs(
    x = "Gender Inequality Index \n(Lower is worse)",
    y = "Total Fertility Rate \n(persons)",
    title = "The Relationship between Gender Equality and Fertility Rates \nin South Korea: 1990 - 2022",
    subtitle = "South Korea's rapidly declining birthrates could be the effect of\n widening gender inequality",
    caption = "Source: KOSIS, United Nations Human Development Report - Gender Inequality Index"
  ) + 
  theme_minimal()+
  theme(
    text = element_text(face = "bold")
  )

```
**MAKE SURE TO COMMIT AFTER FINSIHING**

\pagebreak 
